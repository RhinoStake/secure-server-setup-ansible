---
# Simply restart the node binary called out via the vars_file referenced.

- name: Restart the daemon
  become: true
  ansible.builtin.service:
    name: "{{ daemon }}"
    state: restarted
  register: restart_status
  until: restart_status.status.ActiveState == "active"
  retries: 20
  delay: 20
  listen: "Restart cosmovisor"

- name: Wait 30s and check for rpc response
  ansible.builtin.wait_for:
    port: "{{ custom_port_prefix }}57"
    delay: 30 # wait for 30 seconds before polling
  listen: "Restart cosmovisor"
