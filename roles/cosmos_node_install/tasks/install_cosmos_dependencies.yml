- name: Download go
  ansible.builtin.get_url:
    url: "https://golang.org/dl/{{ go_release }}"
    dest: "/tmp/{{ go_release }}"
    mode: "0700"

- name: Unarchive and install go
  ansible.builtin.shell: "rm -rf /usr/local/go && tar -C /usr/local -xzf /tmp/{{ go_release }}"
  become: true

# Copy .profile with GO additions
- name: Copy .profile
  ansible.builtin.template:
    src: "profile.j2"
    dest: "{{ user_dir }}/.profile"
    owner: "{{ ansible_user }}"
    group: "{{ ansible_user }}"
    mode: "0600"

- name: Go install cosmovisor
  ansible.builtin.shell: "go install github.com/cosmos/cosmos-sdk/cosmovisor/cmd/cosmovisor@{{ cosmovisor_version }}"
  environment:
    PATH: "/usr/local/go/bin"
    GOPATH: "{{ user_dir }}/go"

- name: Change go folder permission
  ansible.builtin.file:
    path: "{{ user_dir }}/go"
    owner: "{{ ansible_user }}"
    group: "{{ ansible_user }}"
    recurse: true
    mode: "0755"
