---
- name: Install essentials
  ansible.builtin.apt:
    name:
      - ufw
      - chrony
      - htop
      - screen
      - git
      - build-essential
      - wget
      - curl
      - fio
      - vim
      - jq
      - tree
      - bc
      - prometheus-node-exporter
      - lz4
      - aria2
      - zip
      - net-tools
      - tuned
      - tmux
      - vlan
      - nvme-cli
      - bash-completion
      - lsof
      - rsync
      - mdadm
    state: present
    update_cache: true
    cache_valid_time: 3600

# Set timezone to UTC
- name: Set timezone to UTC
  community.general.timezone:
    name: Etc/UTC

# Set tune profile
- name: Force tuned server profile to throughput-performance
  ansible.builtin.command: /usr/sbin/tuned-adm profile throughput-performance

# Add toml highlighter for vim
- name: Add TOML vim plugin
  become: false
  ansible.builtin.git:
    repo: https://github.com/cespare/vim-toml.git
    dest: /home/{{ ansible_user }}/.vim/pack/plugins/start/vim-toml
    single_branch: true
    version: main

- name: Create source if it does not exist
  become: false
  ansible.builtin.file:
    path: "{{ user_dir }}/source"
    state: directory
    mode: "0755"

- name: Add Yet Another Benchmark script
  become: false
  ansible.builtin.git:
    repo: https://github.com/masonr/yet-another-bench-script.git
    dest: /home/{{ ansible_user }}/source/yabs
    single_branch: true
    version: master
